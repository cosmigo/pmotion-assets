<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.9">
<meta name="description" content="Cosmigo Pro Motion file I/O interface for plugin developers, presented in a language-agnostic approach.">
<meta name="keywords" content="cosmigo, pro motion ng, pmng, plugins, interface, api, developer, pixel art, pixelart">
<meta name="author" content="Tristano Ajmone">
<meta name="copyright" content="Copyright (c) Tristano Ajmone, Apache License v2.0.">
<title>Pro Motion File I/O Plugin Interface</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./css/styles.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Pro Motion File I/O Plugin Interface</h1>
<div class="details">
<span id="author" class="author">Tristano Ajmone</span><br>
<span id="email" class="email"><a href="mailto:tajmone@gmail.com">tajmone@gmail.com</a></span><br>
<span id="revnumber">draft 1,</span>
<span id="revdate">2019-03-24</span>
<br><span id="revremark">PMNG v7.1.8.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_about_file_io_plugins">About File I/O Plugins</a></li>
<li><a href="#_choosing_a_language">Choosing a Language</a></li>
<li><a href="#_pseudocode_notation">Pseudocode Notation</a></li>
</ul>
</li>
<li><a href="#_interface_overiew">Interface Overiew</a></li>
<li><a href="#_interface_data_types">Interface Data Types</a>
<ul class="sectlevel2">
<li><a href="#_strings">Strings</a></li>
</ul>
</li>
<li><a href="#_procedures_description">Procedures Description</a>
<ul class="sectlevel2">
<li><a href="#initialize">initialize</a></li>
<li><a href="#_setprogresscallback">setProgressCallback</a></li>
<li><a href="#_geterrormessage">getErrorMessage</a></li>
<li><a href="#_getfiletypeid">getFileTypeId</a></li>
<li><a href="#_isreadsupported">isReadSupported</a></li>
<li><a href="#_iswritesupported">isWriteSupported</a></li>
<li><a href="#_iswritetruecolorsupported">isWriteTrueColorSupported</a></li>
<li><a href="#_getfileboxdescription">getFileBoxDescription</a></li>
<li><a href="#_getfileextension">getFileExtension</a></li>
<li><a href="#_setfilename">setFilename</a></li>
<li><a href="#_canhandle">canHandle</a></li>
<li><a href="#_loadbasicdata">loadBasicData</a></li>
<li><a href="#_getwidth">getWidth</a></li>
<li><a href="#_getheight">getHeight</a></li>
<li><a href="#_getimagecount">getImageCount</a></li>
<li><a href="#_canextractpalette">canExtractPalette</a></li>
<li><a href="#_getrgbpalette">getRgbPalette</a></li>
<li><a href="#_gettransparentcolor">getTransparentColor</a></li>
<li><a href="#_isalphaenabled">isAlphaEnabled</a></li>
<li><a href="#_loadnextimage">loadNextImage</a></li>
<li><a href="#_beginwrite">beginWrite</a></li>
<li><a href="#_writenextimage">writeNextImage</a></li>
<li><a href="#_finishprocessing">finishProcessing</a></li>
</ul>
</li>
<li><a href="#_reference_links">Reference Links</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A language-agnostic presentation of Pro Motion file I/O plugin interface, aimed at helping developers design plugins in any programming language.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">DISCLAIMER</div>
<div class="paragraph">
<p>This document is my personal attempt to contribute a language agnostic description of the File I/O interface.
<em>It&#8217;s not</em> part of the official Pro Motion documentation and I&#8217;m acting solely as a Pro Motion NG user and enthusiast.</p>
</div>
<div class="paragraph">
<p>The document is still a draft and I haven&#8217;t yet had a chance to actually test all the plugin procedures in real case scenarios.
Therefore, I&#8217;m the only person responsible for any errors and inaccuracies herein contained.</p>
</div>
<div class="paragraph">
<p>Furthermore, the quality (or lack thereof) of this document is not representative of the quality of Cosmigo GmbH, its products and services; it&#8217;s just my personal effort to explore the subject of plugin development as a hobbist programmer and PMNG end user.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_about_file_io_plugins"><a class="anchor" href="#_about_file_io_plugins"></a>About File I/O Plugins</h3>
<div class="paragraph">
<p>Pro Motion (&gt;=v6.5) allows users to extend the supported images and animations file formats by means of third party file I/O plugins.
Each file plugin can target either images or animations, and it may handle saving and/or loading (either one or both) from/to a specific file format, and will be associated with a specific file extension in the file I/O dialogs of Pro Motion.</p>
</div>
<div class="paragraph">
<p>A file I/O plugin is a DLL (Dynamic-link library) shared library, located inside the <code>plugins</code> subfolder in the installation directory of Pro Motion.
Depending on the bitness of your MS Windows operating system, the path of the <code>plugins</code> folder will be either:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
32 bit OS: 
</td>
<td class="hdlist2">
<p><code>%ProgramFiles%\cosmigo\Pro Motion NG\plugins\</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
64 bit OS: 
</td>
<td class="hdlist2">
<p><code>%ProgramFiles(x86)%\cosmigo\Pro Motion NG\plugins\</code></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any plugins inside that folder will be automatically detected when Pro Motion is launched, and made available in the file load/save and import/export dialogs according to where the plugin functionality fits in PMNG context.
This means that during development, whenever you updated/recompile your DLL you&#8217;ll have to close and restart PM.</p>
</div>
<div class="paragraph">
<p>Since PM is a 32 bit application, the plugin DLL must also be compiled as 32 bit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At the time of this writing, Pro Motion NG is only available as a 32-bit application.
In the future this might change, therefore always check the <a href="https://www.cosmigo.com/" title="Visit Cosmigo website" target="_blank" rel="noopener">Cosmigo website</a> for up-to-date information.</p>
</div>
<div class="paragraph">
<p>If a 64 bit version of PM NG should be released, all file I/O plugins would have to compiled to 64 bit in order to be usable (linkable) by the 64 bit version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_choosing_a_language"><a class="anchor" href="#_choosing_a_language"></a>Choosing a Language</h3>
<div class="paragraph">
<p>The good news about PM plugins is that developers are free to use a variety of different programming languages to create plugins with.
This means that the creation of PM plugins is not restricted to C/C++ gurus, but can be also acomplished with some easier programming languages, including Basic.</p>
</div>
<div class="paragraph">
<p>The &#8220;bad news&#8221; (so to speak) is that the official Cosmigo plugin interface documentation and code samples are intended for an audience with knowledge of either C++ or Delphi, which means that users willing to implement plugins in other languages will have to conduct extensive research on these languages in order to work out data types equivalences and how to overcome some memory management issues implicitly handled behind the scenes by
<a href="https://en.wikipedia.org/wiki/Microsoft_Visual_Studio" target="_blank" rel="noopener">Microsoft Visual Studio</a>
and
<a href="https://edn.embarcadero.com/article/41593" target="_blank" rel="noopener">Embarcadero Delphi XE2</a>.</p>
</div>
<div class="paragraph">
<p>This guide was conceived to simplify the task of implementing PM plugins in any language, by presenting the plugin interface, its data types and the data exchange mechanisms in a language agnostic way&#8201;&#8212;&#8201;i.e. without assuming that the reader has any knowledge of C/C++ or Delphi.
Hopefully, this document will fill the C++/Delphi &#8220;experts gap&#8221; and open the doors of plugins development to programmers coming from all walks of programming life, including beginners who are willing to give it a go, and regardless of the languages they&#8217;re accustomed to work with.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An obvious limitation to this approach is that the guide is bound to provide fairly generic implementation guidelines, for different programming languages have different paradigms.
It would be impossible to provide implmentation-specific advice and preserve language-neutrality at the same time.
Developers will need to adapt the information provided by this guide to the paradigm of their programming language.
Knowers of C++ or Delphi are better off reading the official
<a href="Developer_Interface.html" title="Read the plugins 'Developer Interface' document"><em>Developer Interface</em></a>
document, for it provides implementation-specific details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can create a custom file I/O plugin with any programming language that meets the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compile a 32-bit DLL (no thread-safety required).</p>
</li>
<li>
<p>Export DLL functions using the <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#stdcall" title="Learn more about the stdcall calling convention on Wikipedia" target="_blank" rel="noopener">stdcall</a> calling convention.</p>
</li>
<li>
<p>Support Unicode strings.</p>
</li>
<li>
<p>Support pointers and user define structures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most compiled programming languages for Windows should meet these requirements.
Therefore, developers have an ample choice of languages to pick from for developing PM file I/O plugins, and are by no means bound to use MSVS or Embarcadero Delphi for the task.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pseudocode_notation"><a class="anchor" href="#_pseudocode_notation"></a>Pseudocode Notation</h3>
<div class="paragraph">
<p>To simplify representation of functions, their parameters and datatypes, this document employes an arbitrary and simple pseudocode notation and then describes the parameters in more detail, one by one.
Hopefully, the adopted notation should be self explanatory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interface_overiew"><a class="anchor" href="#_interface_overiew"></a>Interface Overiew</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pro Motion expects the plugin DLL to export some functions with specific names, parameters and return values.
When creating a custom plugin, you must therefore ensure that all those functions are correctly implemented.</p>
</div>
<div class="paragraph">
<p>PM will invoke the DLL functions in a meaningful order, depending on the type of file operation requested by the user.</p>
</div>
<div class="paragraph">
<p>Data exchance is handled by passing pointers to and from the DLL.
Sometimes pointers are used to pass data from PM to the plugin, in which case a function parameter will be a pointer to the memory location storing the data which the plugin should read.
Other times, pointers are used to pass data from the plugin to PM, either via a pointer paramter in the function call, which the plugin should then use to store the requested data in, or by the function being expected to return a pointer to a string.</p>
</div>
<div class="paragraph">
<p>Some functions are expected to return bool values (true/false) to inform PM wether a given feature is available. Error handling is done via the <a href="#_geterrormessage">getErrorMessage</a> plugin function, which will should either return a <code>NULL</code> pointer (no error) or a pointer to string describing the error; PM will invoke this error function right after calling any plugin function that may set error (not every plugin function can set error).</p>
</div>
<div class="paragraph">
<p>The following table lists all the required DLL functions, and specifies which functions are invoked in file load and save operations, and wether the function might set an error or not.</p>
</div>
<table id="procedures-table" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Plugin DLL Procedures Overview</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">function name</th>
<th class="tableblock halign-center valign-top">load</th>
<th class="tableblock halign-center valign-top">save</th>
<th class="tableblock halign-center valign-top">error</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#initialize">initialize</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_setprogresscallback">setProgressCallback</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_geterrormessage">getErrorMessage</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_getfiletypeid">getFileTypeId</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_isreadsupported">isReadSupported</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_iswritesupported">isWriteSupported</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_iswritetruecolorsupported">isWriteTrueColorSupported</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_getfileboxdescription">getFileBoxDescription</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_getfileextension">getFileExtension</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_setfilename">setFilename</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_canhandle">canHandle</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_loadbasicdata">loadBasicData</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_getwidth">getWidth</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_getheight">getHeight</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_getimagecount">getImageCount</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_canextractpalette">canExtractPalette</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_getrgbpalette">getRgbPalette</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_gettransparentcolor">getTransparentColor</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_isalphaenabled">isAlphaEnabled</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_loadnextimage">loadNextImage</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_beginwrite">beginWrite</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_writenextimage">writeNextImage</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="#_finishprocessing">finishProcessing</a></code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">&#x2714;</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">&#x2718;</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_interface_data_types"><a class="anchor" href="#_interface_data_types"></a>Interface Data Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each programming language has its own native data types, and adopts a custom naming convention for the various types.
To avoid confusion about the data types mentioned in this document, I&#8217;ll try to provide language-agnostic description of the data types used by plugins to exchange data with PM.</p>
</div>
<div class="sect2">
<h3 id="_strings"><a class="anchor" href="#_strings"></a>Strings</h3>
<div class="paragraph">
<p>Strings are exchanged between PM and the plugin via pointers.
All strings are expected to be null-terminated and in Unicode (i.e., wide char, 16-bits characters, <code>wchar_t</code>), and not Ascii strings.
If your language allows creating different types of strings, check that you are using the correct type.</p>
</div>
<div class="paragraph">
<p>Because many languages provide a simple syntax to define and work with sting variables (in order to hide the complexity of string pointers), you must ensure that when you pass to PM string pointers you&#8217;re passing a pointer to the memory location of the actual string contents, and not just a pointer to the string variable.
In many languages the memory location of string variable contains just a pointer to the actual string, not the string itself.</p>
</div>
<div class="paragraph">
<p>Furthermore, in order for PM to able to gain read/write memory access to these plugin strings, you&#8217;ll need to use some globally scoped strings which are visible outside the DLL.
How this can be achived will depend largely on the language you&#8217;re using, but chances are that if its syntax provides a &#8216;global&#8217; keyword that should do the trick.
Refer to the language documentation regarding strings, pointers, variables scope and visibility, and creating dynamically linked libraries (DLLs).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>TO BE CONTINUED&#8230;&#8203;</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_procedures_description"><a class="anchor" href="#_procedures_description"></a>Procedures Description</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="initialize"><a class="anchor" href="#initialize"></a>initialize</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">initialize</span><span class="hl opt">(</span>&#x000A;                    <span class="hl kwe">*</span>language  <span class="hl opt">:</span> <span class="hl kwa">char</span><span class="hl opt">[</span><span class="hl num">2</span><span class="hl opt">],</span>&#x000A;                    <span class="hl kwe">*</span>version   <span class="hl opt">:</span> <span class="hl kwa">uint16</span><span class="hl opt">,</span>&#x000A;                    <span class="hl kwe">*</span>animation <span class="hl opt">:</span> <span class="hl kwa">bool</span>&#x000A;                 <span class="hl opt">);</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Parameters</caption>
<colgroup>
<col style="width: 8.6956%;">
<col style="width: 4.3478%;">
<col style="width: 86.9566%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&ast;language</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(<em>in</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to two-characters (Ascii) representing the ISO language code currently used in PM user interface (e.g. '<code>en</code>', '<code>de</code>' or '<code>fr</code>').
Can be used for localization if the plugin supports multi-language messages, otherwise just ignore it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&ast;version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(<em>out</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to <strong>uint16</strong> representing the version number of the file I/O plugin interface.
Must be set to &#8220;1&#8221; to be a valid plugin, as this is the only interface version currently supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&ast;animation</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(<em>out</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to boolean (1 byte/<strong>uint8</strong>).
Plugins targetting animations must set it to <strong>true</strong>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> if successful, <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>General initialization function, called once when PM launches and needs to register the available plugins.</p>
</div>
<div class="paragraph">
<p>The function informs the plugin of the locale being used in PM, and provides pointers for retriving the interface version for which the plugin was designed (for future use, when new interface versions will be introduced) and to determine whether this is a plugin for handling images or animations files.</p>
</div>
<div class="paragraph">
<p>If the plugin targets animation files, then it must set to <strong>true</strong> the byte located at <code>&ast;animation</code>.
Plugins for image files, on the other hand, don&#8217;t need to do anything with <code>&ast;animation</code>.</p>
</div>
<div class="paragraph">
<p>This will always be the first plugin function invoked by PM.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike other error-setting plugin functions, which only need to ensure that <code>getErrorMessage</code> will return a pointer to an error string, <code>initialize</code> must <em>also</em> return <code>false</code> in case of error.
This is because <code>initialize</code> is a special case, for it&#8217;s used to activate the plugin, and it&#8217;s therefore expected to return a boolean indicating success/failure.
In case of failure, it should still set an error description via <code>getErrorMessage</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_setprogresscallback"><a class="anchor" href="#_setprogresscallback"></a>setProgressCallback</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">void</span> <span class="hl opt">:</span> <span class="hl kwd">setProgressCallback</span><span class="hl opt">(</span> <span class="hl kwe">*</span>progressCallback <span class="hl opt">:</span> <span class="hl kwa">function</span> <span class="hl opt">);</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Parameters</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&ast;progressCallback</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Pointer to a PM function that the plugin must call when progress changes.
The PM function located at <code>&ast;progressCallback</code> (stdcall) is representable as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode">void : *progressCallback( int32 progress );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must invoke it accordingly, using only its memory pointer as a means to interface with it.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This function passes to the plugin the memory addres of a PM progress callback function that the plugin should use to provide user feedback regarding the progress of image loading/saving operations.</p>
</div>
<div class="paragraph">
<p>The plugin must interface to the above function (stdcall) using the pointer provided via the <code>&ast;progressCallback</code> parameter.
How this can be achieved will vary from language to language, but you should be looking for a way to call &#8220;foreign functions&#8221; via some
<a href="https://en.wikipedia.org/wiki/Foreign_function_interface" title="See Wikipedia page on FFI" target="_blank" rel="noopener">Foreign function interface (FFI)</a>
mechanism.</p>
</div>
<div class="paragraph">
<p>The <code>progress</code> parameter in the callback function represents progress percentage expressed via an integer value (<strong>int32</strong>).
A progress value of &#8220;0&#8221; will hide progress display in PM, while values in the range &#8220;1&#8221; to &#8220;100&#8221; will make the progress display visible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>PM NG no longer displays a true progress bar, because nowadays it&#8217;s mostly useless due to the speed at which most images are processed, but previous version of PM do; therefore, for the sake of backward compatibility, plugins should honour the progress callback.</p>
</div>
<div class="paragraph">
<p>The important thing here is to provide the end user with some kind of feedback on the ongoing plugin operations, which in PM NG is now shown via a small emphasized panel at the bottom of the main window, along with the cursor shape turning &#8220;busy&#8221;.</p>
</div>
<div class="paragraph">
<p>Plugin developers should call the <code>&ast;progressCallback</code> function to update the user when progress status changes, passing to it progress indications from 1 to 100, if possible.
At least, set it to a non-zero value when the plugin is processing, and then back to zero when processing is over.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_geterrormessage"><a class="anchor" href="#_geterrormessage"></a>getErrorMessage</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwe">*</span><span class="hl kwa">string</span> <span class="hl opt">:</span> <span class="hl kwd">getErrorMessage</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to a string describing the error, or <code>nil</code>/<code>NULL</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If one of the plugin functions that may set error does encounter an error, it can notify PM via indirect usage of this function, i.e. by setting the conditions that will make <code>getErrorMessage()</code> return a pointer to an error string instead of <code>nil</code>.</p>
</div>
<div class="paragraph">
<p>PM will call this function immediately after calling any plugin function that may set error, and <code>getErrorMessage()</code> should either return <code>nil</code> if no error was encountered, or a pointer to a string containing the error description.
PM expects the string to be a Unicode string (wide char, 16-bits characters), not an Ascii string; if your language allows creating different types of strings, check that you are using the correct type.</p>
</div>
<div class="paragraph">
<p>This means that within your plugin DLL <code>getErrorMessage()</code> should be granted access to a string which is also visibile to all functions that may set error (i.e. a global string), and check wether the string is currently empty or contains some text, in the fomer case it should return <code>nil</code>, in the latter it should return the memory address at which the string is stored, for it means that the last plugin function called has set an error which must now be notified and passed on to PM.</p>
</div>
<div class="paragraph">
<p>A pseudocode example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwb">Global</span> <span class="hl kwa">string</span> ErrorMessage<span class="hl opt">;</span> <span class="hl slc">// define a string visibile to all DLL functions</span>&#x000A;&#x000A;<span class="hl kwe">*</span><span class="hl kwa">string</span> <span class="hl opt">:</span> <span class="hl kwd">getErrorMessage</span><span class="hl opt">()</span>&#x000A;<span class="hl opt">{</span>&#x000A;  <span class="hl kwb">If</span> ErrorMessage <span class="hl opt">==</span> <span class="hl str">&quot;&quot;</span>&#x000A;    <span class="hl kwb">Then</span>&#x000A;      <span class="hl slc">// no error currently awaiting to be notified</span>&#x000A;      <span class="hl kwb">Return</span> <span class="hl kwc">nil</span><span class="hl opt">;</span>&#x000A;    <span class="hl kwb">Else</span>&#x000A;      <span class="hl slc">// there is a pending error, return memory address of error string</span>&#x000A;      <span class="hl kwb">Return</span> <span class="hl kwe">&amp;</span>ErrorMessage<span class="hl opt">;</span>&#x000A;  <span class="hl kwb">EndIf</span>&#x000A;<span class="hl opt">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The nature of this indirect error messaging mechanism also requires that all functions that may set error should &#8220;reset&#8221; the aforementioned string to be empty at the beginning of each call, to avoid carrying over errors generated by previous functions calls.
As soon as an error is encountered, the error string should be set to contain a meaningful message about the nature of the problem, and just let <code>getErrorMessage()</code> handle notification of the error to PM, and that the next plugin function (which may set error) that gets called will handle resetting the error string.</p>
</div>
<div class="paragraph">
<p>Not every plugin procedure can set error, only those explicitly indicated in this document (under &#8220;Control&#8221; in the description of each function, as well as in the &#8220;error&#8221; column of <a href="#procedures-table">Table 1</a>).
This was done to avoid burdening PM with having to check for errors at each and every plugin call, and limiting instead these checks to meaningful contexts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getfiletypeid"><a class="anchor" href="#_getfiletypeid"></a>getFileTypeId</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwe">*</span><span class="hl kwa">string</span> <span class="hl opt">:</span> <span class="hl kwd">getFileTypeId</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to a string with the unique identifier of the plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM calls this plugin function in order to acquire a unique identifier for the plugin.
The Id is used by PM as an interanl reference to the plugin, and it&#8217;s not intended to be shown to end users.
For example, if the user saved a file via this plugin and later uses the &#8216;save again&#8217; function, PM will rely on the file type Id to know which plugin to use.</p>
</div>
<div class="paragraph">
<p>The plugin must return a pointer to a string containing the plugin file type Id.</p>
</div>
<div class="paragraph">
<p>The file extension is not unique enough to used as a Id, for there could be several load/save plugins for <code>"bmp-files"</code>.
The Id may be a series of numbers/characters like a GUID, or it may be like a Java package descriptor, e.g. <code>"de.mycompany.promotion.ioplugin.png"</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_isreadsupported"><a class="anchor" href="#_isreadsupported"></a>isReadSupported</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">isReadSupported</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, if read is supported, <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM needs to know if the plugin supports reading from the file format, to determine wether to include the plugin in the file open/import dialogs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_iswritesupported"><a class="anchor" href="#_iswritesupported"></a>isWriteSupported</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">isWriteSupported</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, if write is supported, <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM needs to know if the plugin supports saving to the file format, to determine wether to include the plugin in the file save/export dialogs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_iswritetruecolorsupported"><a class="anchor" href="#_iswritetruecolorsupported"></a>isWriteTrueColorSupported</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">isWriteTrueColorSupported</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, if write is supported, <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM needs to know if the plugin can write true color data to the file format.
Some operations (e.g. automatically flattening layers) may result in colors that don&#8217;t fit into the 256 colors palette.
In these cases the image data can be optionally stored as <a href="https://en.wikipedia.org/wiki/Color_depth#True_color_(24-bit)" title="Read more about true color on Wikipedia" target="_blank" rel="noopener">true color</a> (24-bit color depth).
If the plugin doesn&#8217;t support true color then the image colors are reduced to 256 indexed colors.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getfileboxdescription"><a class="anchor" href="#_getfileboxdescription"></a>getFileBoxDescription</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwe">*</span><span class="hl kwa">string</span> <span class="hl opt">:</span> <span class="hl kwd">getFileBoxDescription</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to a string with the file type description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM needs a file type description string to represent the plugin in the file I/O dialogs, e.g. &#8220;BMP Windows Bitmap RLE&#8221;.
You should place the file type abbreviation (usually the file extension) at the beginning of the string so that it can be sorted correctly in the drop down menu, making it easier for end users to sift through the list of available file types.</p>
</div>
<div class="paragraph">
<p>If your plugin supports internationalization, you should return a pointer to a string in the language matching the user&#8217;s locale (which the plugin has already detected during the <a href="#initialize"><code>initialize()</code></a> call).</p>
</div>
</div>
<div class="sect2">
<h3 id="_getfileextension"><a class="anchor" href="#_getfileextension"></a>getFileExtension</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwe">*</span><span class="hl kwa">string</span> <span class="hl opt">:</span> <span class="hl kwd">getFileExtension</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to a string with the file extension supported by this plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This function must return the file extension (without &#8220;.&#8221;) to be used in the file filter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setfilename"><a class="anchor" href="#_setfilename"></a>setFilename</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">void</span> <span class="hl opt">:</span> <span class="hl kwd">setFilename</span><span class="hl opt">(</span> <span class="hl kwe">*</span>filename <span class="hl opt">);</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Parameters</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>filename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to a string with full path and name of the file to process.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM calls this function to inform the plugin that a new file is about to be processed and provides a full path to the corresponding file.
The plugin should reset its internal structures and references if the file name is different from the previously set file.</p>
</div>
<div class="paragraph">
<p>At this stage, it is still undefined if the file is intended for read or write operations!</p>
</div>
<div class="paragraph">
<p>Calls to this function might be triggered by different contexts.
For example, by the user when her/she selects in a file I/O dialog a file registered to the plugin.
But it might also be triggered multiple times by PM as a result of a multi file operation (e.g. <span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Create from single Images&#8230;&#8203;</b></span>, <span class="menuseq"><b class="menu">Animation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Save as single Images&#8230;&#8203;</b></span>, etc.).</p>
</div>
<div class="paragraph">
<p>The plugin at this stage only needs to acknowledge the file, memorize its references, and be prepared.</p>
</div>
</div>
<div class="sect2">
<h3 id="_canhandle"><a class="anchor" href="#_canhandle"></a>canHandle</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">canHandle</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, if the file can be processed.
  If <code>false</code> is returned then an error message must be set saying why it can not be handled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This function is called by PM to get confirmation that the plugin is capable of handling reading the selected file (i.e. the file indicated via the <a href="#_setfilename"><code>setFilename()</code></a> call).
The plugin should open the file and carry out the necessary checks and then return either <code>true</code> or <code>false</code> accordingly.
In case the plugin is unable to handle the file, it should also set an error with a sting describing the reason why the file can&#8217;t be handled.</p>
</div>
<div class="paragraph">
<p>Some image/animation formats may have many variants, yet share the same file extension, and a plugin might support only some features of the format and not others.
When this function is called the plugin must check if the selected file is actually supported, by doing some basic checks on the file header, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_loadbasicdata"><a class="anchor" href="#_loadbasicdata"></a>loadBasicData</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">loadBasicData</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, if the file data could be loaded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Before actually reading any graphics data, PM calls this function
so that the plugin can extract some basic graphics data information from the target file, such as its dimensions, color palette, and other relevant data.
Other functions will rely on this function having been called before them&#8201;&#8212;&#8201;for example <a href="#_getwidth"><code>getWidth()</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getwidth"><a class="anchor" href="#_getwidth"></a>getWidth</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">int32</span> <span class="hl opt">:</span> <span class="hl kwd">getWidth</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The width in pixels of the image that is to be loaded, or -1 if the function fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM calls this function to learn from the plugin the width of the image which is going to be loaded, so it can prepare to receive it accordingly.</p>
</div>
<div class="paragraph">
<p>The returned value must be a 32-bit signed integer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#_loadbasicdata"><code>loadBasicData()</code></a> has been already been called by PM before using this function, to ensure that the plugin has acquired this information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_getheight"><a class="anchor" href="#_getheight"></a>getHeight</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">int32</span> <span class="hl opt">:</span> <span class="hl kwd">getHeight</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The height in pixels of the image that is to be loaded, or -1 if the function fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM calls this function to learn from the plugin the height of the image which is going to be loaded, so it can prepare to receive it accordingly.</p>
</div>
<div class="paragraph">
<p>The returned value must be a 32-bit signed integer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#_loadbasicdata"><code>loadBasicData()</code></a> has been already been called by PM before using this function, to ensure that the plugin has acquired this information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_getimagecount"><a class="anchor" href="#_getimagecount"></a>getImageCount</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">int32</span> <span class="hl opt">:</span> <span class="hl kwd">getImageCount</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of frames of the image/animation that is to be loaded or -1 on failure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM calls this function to learn from the plugin how many image frames are present in the file which is going to be loaded, so it can prepare to receive them accordingly.</p>
</div>
<div class="paragraph">
<p>This function must return a 32-bit signed integer with the number of frames available to load from the file.
If the file consists of a single image then &#8220;1&#8221; is to be returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#_loadbasicdata"><code>loadBasicData()</code></a> has been already been called by PM before using this function, to ensure that the plugin has acquired this information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_canextractpalette"><a class="anchor" href="#_canextractpalette"></a>canExtractPalette</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">canExtractPalette</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the plugin supports palette reading then this function must return <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM allows users to load just the color palette from a graphic file, without loading the graphic/bitmap data.
PM calls this function to ask the plugin if it&#8217;s capable of handling extracting just the palette from a target file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getrgbpalette"><a class="anchor" href="#_getrgbpalette"></a>getRgbPalette</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwe">*</span><span class="hl kwa">array</span> <span class="hl opt">:</span> <span class="hl kwd">getRgbPalette</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to the RGB palette or <code>nil</code>/<code>NULL</code> if palette extraction is not supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For plugins that support extracting the palette data, this function must return a pointer to the memory location storing the 256-colors indexed palette.
The palette must be defined as a 768 bytes (256&#160;x&#160;3) sequence of RGB triplets (one byte per channel) representing the indexed colors, starting with color &#8220;0&#8221;.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#_loadbasicdata"><code>loadBasicData()</code></a> has been already been called by PM before using this function, to ensure that the plugin has acquired this information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_gettransparentcolor"><a class="anchor" href="#_gettransparentcolor"></a>getTransparentColor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">int32</span> <span class="hl opt">:</span> <span class="hl kwd">getTransparentColor</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The palette index of the transparent color, or -1 if none.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the image contains a transparent color then this function must return its palette color entry/index (first entry is 0).</p>
</div>
<div class="paragraph">
<p>The returned value must be a 32-bit signed integer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#_loadbasicdata"><code>loadBasicData()</code></a> has been already been called by PM before using this function, to ensure that the plugin has acquired this information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_isalphaenabled"><a class="anchor" href="#_isalphaenabled"></a>isAlphaEnabled</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">isAlphaEnabled</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the image contains alpha data then this function must return <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM wants to know wether the image/animation file which is going to be loaded contains alpha transparency data or not.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#_loadbasicdata"><code>loadBasicData()</code></a> has been already been called by PM before using this function, to ensure that the plugin has acquired this information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_loadnextimage"><a class="anchor" href="#_loadnextimage"></a>loadNextImage</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">loadNextImage</span><span class="hl opt">(</span>&#x000A;                      <span class="hl kwe">*</span>colorFrame<span class="hl opt">,</span>&#x000A;                      <span class="hl kwe">*</span>colorFramePalette<span class="hl opt">,</span>&#x000A;                      <span class="hl kwe">*</span>alphaFrame<span class="hl opt">,</span>&#x000A;                      <span class="hl kwe">*</span>alphaFramePalette<span class="hl opt">,</span>&#x000A;                      <span class="hl kwe">*</span>delayMs&#x000A;                    <span class="hl opt">);</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Parameters</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;colorFrame</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the bitmap holding the color pixels (color palette indexes).
  The memory portion has a size of <code>getWidth</code> * <code>getHeight</code> bytes!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;colorFramePalette</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the RGB color table.
  There are 768 bytes being 256 colors with one byte for red, green and blue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;alphaFrame</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the bitmap holding the alpha palette indexes.
  The memory portion has a size of <code>getWidth</code> * <code>getHeight</code> bytes!
  If alpha is not supported then this value is <code>nil</code>/<code>NULL</code> and must not be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;alphaFramePalette</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the alpha value table.
  There are 256 bytes.
  Each byte is an alpha value ranging from 0 to 255.
  If alpha is not supported then this value is <code>nil</code>/<code>NULL</code> and must not be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;delayMs</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the frame has a delay value (animations only) then it must be given here as milliseconds.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the data was transfered successfuly then <code>true</code> is to be returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For plugins that support reading, this function is used to load the image data.
After executing this function the plugin must advance to the next frame, if any.
The function will be called according to the number of frames returned by <a href="#_getimagecount"><code>getImageCount()</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="#_loadbasicdata"><code>loadBasicData()</code></a> has been already been called by PM before using this function, to ensure that the plugin has acquired this information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_beginwrite"><a class="anchor" href="#_beginwrite"></a>beginWrite</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">beginWrite</span><span class="hl opt">(</span>&#x000A;              <span class="hl kwa">int32</span> width<span class="hl opt">,</span>&#x000A;              <span class="hl kwa">int32</span> height<span class="hl opt">,</span>&#x000A;              <span class="hl kwa">int32</span> transparentColor<span class="hl opt">,</span>&#x000A;              <span class="hl kwa">bool</span>  alphaEnabled<span class="hl opt">,</span>&#x000A;              <span class="hl kwa">int32</span> numberOfFrames&#x000A;                 <span class="hl opt">);</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Parameters</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>width</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Width of the graphic (images).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>height</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Height of the graphic (images).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>transparentColor</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The palette index of the transparent color,  or -1 if none.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>alphaEnabled</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the graphic will store alpha data then this flag is set to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>numberOfFrames</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of frames that will be written.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> on success</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Before writing graphic data, PM wil call this function once to inform the plugin about the dimensions of the data that will be stored.</p>
</div>
<div class="paragraph">
<p>The output file shall reamin open until <a href="#_finishprocessing"><code>finishProcessing()</code></a> is called.</p>
</div>
</div>
<div class="sect2">
<h3 id="_writenextimage"><a class="anchor" href="#_writenextimage"></a>writeNextImage</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">bool</span> <span class="hl opt">:</span> <span class="hl kwd">writeNextImage</span><span class="hl opt">(</span>&#x000A;                        <span class="hl kwe">*</span>colorFrame<span class="hl opt">,</span>&#x000A;                        <span class="hl kwe">*</span>colorFramePalette<span class="hl opt">,</span>&#x000A;                        <span class="hl kwe">*</span>alphaFrame<span class="hl opt">,</span>&#x000A;                        <span class="hl kwe">*</span>alphaFramePalette<span class="hl opt">,</span>&#x000A;                        <span class="hl kwe">*</span>rgba<span class="hl opt">,</span>&#x000A;                  <span class="hl kwa">uint16</span> delayMs&#x000A;                     <span class="hl opt">);</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Parameters</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;colorFrame</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the bitmap holding the color pixels (color palette indexes).
  The memory portion has a size of <code>getWidth</code> * <code>getHeight</code> bytes!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;colorFramePalette</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the RGB color table.
  There are 768 bytes being 256 colors with one byte for red, green and blue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;alphaFrame</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the bitmap holding the alpha palette indexes.
  The memory portion has a size of <code>getWidth</code> * <code>getHeight</code> bytes!
  If alpha is not supported then this value is <code>nil</code>/<code>NULL</code> and must not be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;alphaFramePalette</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the alpha value table.
  There are 256 bytes.
  Each byte is an alpha value ranging from 0 to 255.
  If alpha is not supported then this value is <code>nil</code>/<code>NULL</code> and must not be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>&ast;rgba</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A pointer to the bitmap holding the color pixels represented as RGBA (each pixel being a <strong>uint32</strong>/<strong>dword</strong>) where the lowest byte is the red channel.
  The memory portion has a size of <code>getWidth</code> * <code>getHeight</code> * 4 bytes!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>delayMs</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the frame has a delay value (animation only) then it&#8217;s provided here as milliseconds.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the data was transfered successfuly then <code>true</code> must be returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For plugins that support reading, this function is used to save the image data.
The function will be called as often as there are more frames to be stored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_finishprocessing"><a class="anchor" href="#_finishprocessing"></a>finishProcessing</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight" lang="pseudocode"><code class="language-pseudocode" data-lang="pseudocode"><span class="hl kwa">void</span> <span class="hl opt">:</span> <span class="hl kwd">finishProcessing</span><span class="hl opt">();</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Control</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">May set error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PM will call this function when the file read or write operation is completed.
The plugin must now close the file and carry out all the required wrap-up chores&#8201;&#8212;&#8201;destroy any memory data and references to the processed file, free memory, release handles, etc., but still be ready for further file I/O operations, for this call only confirms the termination of the current file I/O operation, but the plugin still remains actively availabe at the service of PM for further (new) file operations.</p>
</div>
<div class="paragraph">
<p>When this function is called, the plugin should basically just ensure that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System memory and resources used during the file processing are now set free.</p>
</li>
<li>
<p>When the next file is processed, no information is carried over from the previous file operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If memory is not managed properly, the risk is that multiple plugin invocations will end piling up garbage in memory, eat up system resource and/or lead to memory corruption.
You must also ensure that the plugin won&#8217;t end up keeping a handle on the processed file, which could prevent the user from deleting, renaming or moving the file until PM is running (this being a commonly occuring problem under MS Windows, which can be entirely avoided by good housekeeping during the wrap-up stage).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reference_links"><a class="anchor" href="#_reference_links"></a>Reference Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some external links to useful resources on the topics covered in this article.</p>
</div>
<div class="paragraph">
<p>Wikipedia:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Dynamic-link_library" title="Visit the Wikipedia page on this topic" target="_blank" rel="noopener">Dynamic-link library (DLL)</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/X86_calling_conventions" title="Visit the Wikipedia page on this topic" target="_blank" rel="noopener">x86 calling conventions</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Foreign_function_interface" title="Visit the Wikipedia page on this topic" target="_blank" rel="noopener">Foreign function interface (FFI)</a></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This document was written by
<a href="https://github.com/tajmone" target="_blank" rel="noopener">Tristano Ajmone</a>
and published under the
<a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener">Apache License v2.0</a> terms.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
draft 1<br>
</div>
</div>
</body>
</html>